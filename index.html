<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>2025년 12월 결산 보고서</title>
  <style>
    :root{
      --sheet-w: 900px;   /* “원본 종이” 기준 폭 */
      --sheet-pad: 22px;
      --ink:#111;
      --grid:#222;
      --b:3px;
      --b2:2px;
      --red:#d82222;
      --bg:#f3f4f6;
      --paper:#fff;
      --font:"Apple SD Gothic Neo","Noto Sans KR",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;

      /* JS가 넣어줌 */
      --s: 1;     /* scale */
      --tx: 0px;  /* translateX */
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:var(--bg);
      font-family:var(--font);
      color:var(--ink);
      overflow-x:hidden; /* 가로 스크롤/잘림 느낌 방지 */
    }

    /* 화면(아이폰)에서 한 장으로 보이게 */
    .stage{
      min-height:100vh;
      padding: 10px 10px 24px;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      overflow:hidden; /* 좌우 삐져나오는 픽셀 방지 */
    }

    .sheetWrap{
      width: var(--sheet-w);
      transform-origin: top left;
      transform: translateX(var(--tx)) scale(var(--s));
      will-change: transform;
    }

    .sheet{
      width: var(--sheet-w);
      background:var(--paper);
      border:1px solid #d5d7db;
      box-shadow:0 8px 28px rgba(0,0,0,.08);
      padding:var(--sheet-pad);
    }

    /* 입력칸처럼 안 보이게 */
    input, textarea{
      border:0;
      outline:none;
      background:transparent;
      font:inherit;
      color:inherit;
      padding:0;
      margin:0;
      min-width:0;
    }
    .num{ text-align:right; white-space:nowrap; overflow:hidden; text-overflow:clip; }
    .txt{ width:100%; }
    [contenteditable="true"]{ outline:none; }

    /* 제목: 정중앙 */
    .title{
      text-align:center;
      font-weight:900;
      font-size:56px;
      letter-spacing:-1px;
      margin:6px 0 14px;
      line-height:1.02;
      color:#143a63;
    }

    /* 상단 로고/사인/직인 영역 “전부 삭제” 상태로 유지 */

    /* 상단 요약 3칸 */
    .summary{
      border:var(--b) solid var(--ink);
      margin:6px 0 12px;
    }
    .summaryGrid{
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
    }
    .sumCell{ border-right:var(--b) solid var(--ink); }
    .sumCell:last-child{ border-right:0; }
    .sumHead{
      border-bottom:var(--b) solid var(--ink);
      text-align:center;
      font-size:20px;
      padding:10px 8px;
      letter-spacing:1px;
      font-weight:900;
    }
    .sumVal{
      text-align:center;
      font-weight:900;
      font-size:34px;
      padding:14px 10px;
    }
    .sumVal .num{
      width:100%;
      font-weight:900;
      font-size:34px;
      text-align:center;
      white-space:nowrap;
    }
    .sumVal.red{ color:var(--red); }
    .sumVal.red input{ color:var(--red); }

    /* 섹션 타이틀 */
    .sectionTitle{
      display:flex;
      align-items:center;
      gap:10px;
      margin:10px 0 8px;
      font-weight:900;
      font-size:22px;
    }
    .dot{
      width:18px;height:18px;
      border:2px solid var(--ink);
      border-radius:50%;
      flex:0 0 auto;
    }

    /* 표 공통 (칸 늘어나지 않게 고정) */
    table{ width:100%; border-collapse:collapse; table-layout:fixed; }
    .tbl{ border:var(--b) solid var(--ink); }
    .tbl th,.tbl td{
      border:var(--b2) solid var(--grid);
      padding:6px 8px;
      font-size:16px;
      vertical-align:middle;
      overflow:hidden;          /* 입력해도 셀 폭 안 늘어남 */
      white-space:nowrap;       /* 숫자 줄바꿈 금지 */
      text-overflow:clip;
    }
    .tbl th{
      background:#f2f2f2;
      text-align:center;
      font-weight:900;
      letter-spacing:2px;
    }

    /* 수입/지출 표 */
    .noteLine{
      border:var(--b) solid var(--ink);
      padding:8px 10px;
      margin:-2px 0 8px;
      font-size:14px;
      text-align:center;
      font-weight:800;
      color:#222;
    }

    /* 은행 표 (기업/농협 2개만, 통장잔액 컬럼 표시용 삭제) */
    .bankGrid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    .bankCard{
      border:var(--b) solid var(--ink);
      padding:0;
    }
    .bankTitle{
      border-bottom:var(--b2) solid var(--grid);
      text-align:center;
      font-weight:900;
      padding:6px 0;
      letter-spacing:3px;
      font-size:18px;
    }
    .prevRow{
      display:grid;
      grid-template-columns:160px 1fr;
      border-bottom:var(--b2) solid var(--grid);
    }
    .prevRow .label{
      background:#f7f7f7;
      border-right:var(--b2) solid var(--grid);
      text-align:center;
      font-weight:900;
      padding:8px 8px;
      letter-spacing:1px;
    }
    .prevRow .val{
      padding:8px 8px;
      font-weight:900;
      text-align:right;
      white-space:nowrap;
      overflow:hidden;
    }

    /* 은행 헤더 색(캡쳐 느낌) */
    .h-in{ background:#dfe7ff !important; }
    .h-out{ background:#ffe6d7 !important; }
    .h-bal{ background:#dff3e7 !important; }

    /* “숫자 안 잘리게”를 위해 비율 조정: 적요 약간 줄이고 입/출/잔 넓힘 */
    .bankTbl col.desc{ width:34%; }
    .bankTbl col.in{ width:22%; }
    .bankTbl col.out{ width:22%; }
    .bankTbl col.bal{ width:22%; }

    /* 통합잔액 박스 */
    .integrated{
      border:var(--b) solid var(--ink);
      margin-top:10px;
      padding:10px 12px;
    }
    .integratedTitle{
      font-weight:900;
      letter-spacing:1px;
      font-size:16px;
    }
    .integratedVal{
      margin-top:6px;
      text-align:right;
      font-size:34px;
      font-weight:900;
      color:var(--red);
      white-space:nowrap;
      overflow:hidden;
    }

    /* 하단: 테두리 전부 제거(요청) */
    .footer{
      margin-top:10px;
      padding:8px 0 0;
      text-align:center;
      font-weight:900;
      letter-spacing:1px;
      color:#111;
    }
    .footerRow{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:10px;
      margin-top:10px;
      font-weight:900;
      font-size:22px;
    }
    .companyBig{ font-size:26px; font-weight:900; }
    .ceoBig{ font-size:26px; font-weight:900; position:relative; padding-right:90px; } /* 도장 자리 확보 */

    /* 도장: ‘욱’ 위치 근처에 투명 오버레이 (이미지 파일을 dataURL로 바꿔 넣으면 더 확실) */
    .stamp{
      position:absolute;
      right:0;
      bottom:-6px;
      width:86px;
      height:86px;
      opacity:.55;            /* 투명 느낌 */
      mix-blend-mode:multiply;/* 흰 배경에서 자연스럽게 */
      pointer-events:none;
      object-fit:contain;
    }

    @media print{
      body{ background:#fff; }
      .stage{ padding:0; }
      .sheet{ border:0; box-shadow:none; }
      .sheetWrap{ transform:none !important; }
    }
  </style>
</head>

<body>
  <div class="stage">
    <div class="sheetWrap" id="sheetWrap">
      <div class="sheet" id="sheet">

        <div class="title">2025년 12월 결산 보고서</div>

        <!-- 상단 3칸 -->
        <div class="summary">
          <div class="summaryGrid">
            <div class="sumCell">
              <div class="sumHead"><span contenteditable="true" id="lblCarry">11월 이월금액</span></div>
              <div class="sumVal"><input class="num" id="carry" value="25,554,575" inputmode="numeric"/></div>
            </div>
            <div class="sumCell">
              <div class="sumHead">수 입 - 지 출</div>
              <div class="sumVal"><input class="num" id="net" value="-15,443,632" readonly/></div>
            </div>
            <div class="sumCell">
              <div class="sumHead"><span contenteditable="true" id="lblEnd">12월 31일 통장잔액</span></div>
              <div class="sumVal red"><input class="num" id="endBal" value="10,110,943" readonly/></div>
            </div>
          </div>
        </div>

        <!-- 수입/지출 -->
        <div class="sectionTitle">
          <div class="dot"></div>
          <span contenteditable="true" id="lblIncomeExp">12월 수입/지출 내역서</span>
        </div>
        <div class="noteLine">( 수입은 한달전 생산된 금액입니다. 한달지연 입금됩니다 )</div>

        <table class="tbl" id="ieTable">
          <colgroup>
            <col style="width:30%"><!-- 수입 적요 -->
            <col style="width:15%"><!-- 수입 금액 -->
            <col style="width:30%"><!-- 지출 적요 -->
            <col style="width:15%"><!-- 지출 금액 -->
            <col style="width:10%"><!-- 비고 -->
          </colgroup>
          <thead>
            <tr>
              <th colspan="2">수&nbsp;&nbsp;입</th>
              <th colspan="2">지&nbsp;&nbsp;출</th>
              <th>비&nbsp;&nbsp;고</th>
            </tr>
            <tr>
              <th>적&nbsp;&nbsp;요</th>
              <th>금&nbsp;&nbsp;액</th>
              <th>적&nbsp;&nbsp;요</th>
              <th>금&nbsp;&nbsp;액</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <!-- 캡쳐 느낌으로 기본 12줄(원하면 늘려도 로직 그대로) -->
            <tr>
              <td><input class="txt" value="1차 SMP"></td>
              <td><input class="num inAmt" value="8,508,100" inputmode="numeric"></td>
              <td><input class="txt" value="송전료"></td>
              <td><input class="num outAmt" value="347,720" inputmode="numeric"></td>
              <td><input class="txt" value=""></td>
            </tr>
            <tr>
              <td><input class="txt" value="2차 SMP"></td>
              <td><input class="num inAmt" value="6,967,300" inputmode="numeric"></td>
              <td><input class="txt" value="이사회 식대"></td>
              <td><input class="num outAmt" value="52,000" inputmode="numeric"></td>
              <td><input class="txt" value=""></td>
            </tr>
            <tr>
              <td><input class="txt" value="3차 SMP"></td>
              <td><input class="num inAmt" value="4,527,300" inputmode="numeric"></td>
              <td><input class="txt" value="사랑과사랑세무사"></td>
              <td><input class="num outAmt" value="154,000" inputmode="numeric"></td>
              <td><input class="txt" value=""></td>
            </tr>
            <tr>
              <td><input class="txt" value="4차 SMP"></td>
              <td><input class="num inAmt" value="1,895,650" inputmode="numeric"></td>
              <td><input class="txt" value="보상금"></td>
              <td><input class="num outAmt" value="10,500,500" inputmode="numeric"></td>
              <td><input class="txt" value=""></td>
            </tr>
            <tr>
              <td><input class="txt" value="KT 전력예측"></td>
              <td><input class="num inAmt" value="0" inputmode="numeric"></td>
              <td><input class="txt" value="대표및이사회수당"></td>
              <td><input class="num outAmt" value="800,000" inputmode="numeric"></td>
              <td><input class="txt" value=""></td>
            </tr>
            <tr>
              <td><input class="txt" value="rec"></td>
              <td><input class="num inAmt" value="0" inputmode="numeric"></td>
              <td><input class="txt" value="군청근조화환"></td>
              <td><input class="num outAmt" value="100,000" inputmode="numeric"></td>
              <td><input class="txt" value=""></td>
            </tr>
            <tr>
              <td><input class="txt" value="이자"></td>
              <td><input class="num inAmt" value="946" inputmode="numeric"></td>
              <td><input class="txt" value="이음복스"></td>
              <td><input class="num outAmt" value="93,700" inputmode="numeric"></td>
              <td><input class="txt" value=""></td>
            </tr>
            <tr>
              <td><input class="txt" value="이자"></td>
              <td><input class="num inAmt" value="5,492" inputmode="numeric"></td>
              <td><input class="txt" value="토지임대료"></td>
              <td><input class="num outAmt" value="14,300,000" inputmode="numeric"></td>
              <td><input class="txt" value=""></td>
            </tr>
            <tr>
              <td><input class="txt" value=""></td>
              <td><input class="num inAmt" value="0" inputmode="numeric"></td>
              <td><input class="txt" value="운영비"></td>
              <td><input class="num outAmt" value="11,000,500" inputmode="numeric"></td>
              <td><input class="txt" value=""></td>
            </tr>
            <tr><td><input class="txt" value=""></td><td><input class="num inAmt" value="0" inputmode="numeric"></td><td><input class="txt" value=""></td><td><input class="num outAmt" value="0" inputmode="numeric"></td><td><input class="txt" value=""></td></tr>
            <tr><td><input class="txt" value=""></td><td><input class="num inAmt" value="0" inputmode="numeric"></td><td><input class="txt" value=""></td><td><input class="num outAmt" value="0" inputmode="numeric"></td><td><input class="txt" value=""></td></tr>
            <tr><td><input class="txt" value=""></td><td><input class="num inAmt" value="0" inputmode="numeric"></td><td><input class="txt" value=""></td><td><input class="num outAmt" value="0" inputmode="numeric"></td><td><input class="txt" value=""></td></tr>
          </tbody>
          <tfoot>
            <tr>
              <th>합&nbsp;&nbsp;계</th>
              <th class="num" id="sumIn">0</th>
              <th>합&nbsp;&nbsp;계</th>
              <th class="num" id="sumOut">0</th>
              <th class="num" id="netFoot">0</th>
            </tr>
          </tfoot>
        </table>

        <!-- 은행 -->
        <div class="sectionTitle" style="margin-top:14px;">
          <div class="dot"></div>
          <span contenteditable="true" id="lblBank">12월 은행 입출금 내역</span>
        </div>

        <div class="bankGrid" id="bankGrid">
          <!-- 기업은행 -->
          <div class="bankCard">
            <div class="bankTitle">기&nbsp;업&nbsp;은&nbsp;행</div>
            <div class="prevRow">
              <div class="label">전월이월액</div>
              <div class="val"><input class="num" id="ibPrev" value="15,541,634" inputmode="numeric"></div>
            </div>
            <table class="bankTbl">
              <colgroup>
                <col class="desc"><col class="in"><col class="out"><col class="bal">
              </colgroup>
              <thead>
                <tr>
                  <th>적&nbsp;요</th>
                  <th class="h-in">입&nbsp;금</th>
                  <th class="h-out">출&nbsp;금</th>
                  <th class="h-bal">잔&nbsp;액</th>
                </tr>
              </thead>
              <tbody id="ibBody">
                <!-- 캡쳐 느낌: 행 수는 여기서 고정(원하면 늘릴 수 있지만 “캡쳐와 동일”은 너가 지정한 개수로 유지해야 함) -->
                <tr><td><input class="txt" value="전력거래소"></td><td><input class="num ibIn" value="8,508,100" inputmode="numeric"></td><td><input class="num ibOut" value="0" inputmode="numeric"></td><td class="num ibBal">0</td></tr>
                <tr><td><input class="txt" value="염전마을주"></td><td><input class="num ibIn" value="0" inputmode="numeric"></td><td><input class="num ibOut" value="15,500,000" inputmode="numeric"></td><td class="num ibBal">0</td></tr>
                <tr><td><input class="txt" value="이자"></td><td><input class="num ibIn" value="946" inputmode="numeric"></td><td><input class="num ibOut" value="0" inputmode="numeric"></td><td class="num ibBal">0</td></tr>
                <tr><td><input class="txt" value="전력거래소"></td><td><input class="num ibIn" value="6,967,300" inputmode="numeric"></td><td><input class="num ibOut" value="0" inputmode="numeric"></td><td class="num ibBal">0</td></tr>
                <tr><td><input class="txt" value="전력거래소"></td><td><input class="num ibIn" value="4,527,300" inputmode="numeric"></td><td><input class="num ibOut" value="0" inputmode="numeric"></td><td class="num ibBal">0</td></tr>
                <tr><td><input class="txt" value="염전마을주"></td><td><input class="num ibIn" value="0" inputmode="numeric"></td><td><input class="num ibOut" value="14,300,000" inputmode="numeric"></td><td class="num ibBal">0</td></tr>
                <tr><td><input class="txt" value="전력거래소"></td><td><input class="num ibIn" value="1,895,650" inputmode="numeric"></td><td><input class="num ibOut" value="0" inputmode="numeric"></td><td class="num ibBal">0</td></tr>
                <!-- 빈칸들 -->
                <tr><td><input class="txt" value=""></td><td><input class="num ibIn" value="0" inputmode="numeric"></td><td><input class="num ibOut" value="0" inputmode="numeric"></td><td class="num ibBal">0</td></tr>
                <tr><td><input class="txt" value=""></td><td><input class="num ibIn" value="0" inputmode="numeric"></td><td><input class="num ibOut" value="0" inputmode="numeric"></td><td class="num ibBal">0</td></tr>
                <tr><td><input class="txt" value=""></td><td><input class="num ibIn" value="0" inputmode="numeric"></td><td><input class="num ibOut" value="0" inputmode="numeric"></td><td class="num ibBal">0</td></tr>
                <tr><td><input class="txt" value=""></td><td><input class="num ibIn" value="0" inputmode="numeric"></td><td><input class="num ibOut" value="0" inputmode="numeric"></td><td class="num ibBal">0</td></tr>
                <tr><td><input class="txt" value=""></td><td><input class="num ibIn" value="0" inputmode="numeric"></td><td><input class="num ibOut" value="0" inputmode="numeric"></td><td class="num ibBal">0</td></tr>
                <tr><td><input class="txt" value=""></td><td><input class="num ibIn" value="0" inputmode="numeric"></td><td><input class="num ibOut" value="0" inputmode="numeric"></td><td class="num ibBal">0</td></tr>
              </tbody>
              <tfoot>
                <tr>
                  <th>합&nbsp;&nbsp;계</th>
                  <th class="num" id="ibSumIn">0</th>
                  <th class="num" id="ibSumOut">0</th>
                  <th class="num" id="ibEnd">0</th>
                </tr>
              </tfoot>
            </table>
          </div>

          <!-- 농협 -->
          <div class="bankCard">
            <div class="bankTitle">농&nbsp;&nbsp;협</div>
            <div class="prevRow">
              <div class="label">전월이월액</div>
              <div class="val"><input class="num" id="nhPrev" value="10,012,941" inputmode="numeric"></div>
            </div>
            <table class="bankTbl">
              <colgroup>
                <col class="desc"><col class="in"><col class="out"><col class="bal">
              </colgroup>
              <thead>
                <tr>
                  <th>적&nbsp;요</th>
                  <th class="h-in">입&nbsp;금</th>
                  <th class="h-out">출&nbsp;금</th>
                  <th class="h-bal">잔&nbsp;액</th>
                </tr>
              </thead>
              <tbody id="nhBody">
                <tr><td><input class="txt" value="이음복스"></td><td><input class="num nhIn" value="0" inputmode="numeric"></td><td><input class="num nhOut" value="93,700" inputmode="numeric"></td><td class="num nhBal">0</td></tr>
                <tr><td><input class="txt" value="이사회식대"></td><td><input class="num nhIn" value="0" inputmode="numeric"></td><td><input class="num nhOut" value="52,000" inputmode="numeric"></td><td class="num nhBal">0</td></tr>
                <tr><td><input class="txt" value="염전마을주"></td><td><input class="num nhIn" value="15,500,000" inputmode="numeric"></td><td><input class="num nhOut" value="0" inputmode="numeric"></td><td class="num nhBal">0</td></tr>
                <tr><td><input class="txt" value="송전료"></td><td><input class="num nhIn" value="0" inputmode="numeric"></td><td><input class="num nhOut" value="347,720" inputmode="numeric"></td><td class="num nhBal">0</td></tr>
                <tr><td><input class="txt" value="김균태회계"></td><td><input class="num nhIn" value="0" inputmode="numeric"></td><td><input class="num nhOut" value="154,000" inputmode="numeric"></td><td class="num nhBal">0</td></tr>
                <tr><td><input class="txt" value="보상금"></td><td><input class="num nhIn" value="0" inputmode="numeric"></td><td><input class="num nhOut" value="10,500,500" inputmode="numeric"></td><td class="num nhBal">0</td></tr>
                <tr><td><input class="txt" value="대표,이사회수당"></td><td><input class="num nhIn" value="0" inputmode="numeric"></td><td><input class="num nhOut" value="800,000" inputmode="numeric"></td><td class="num nhBal">0</td></tr>
                <tr><td><input class="txt" value="군청근조화환"></td><td><input class="num nhIn" value="0" inputmode="numeric"></td><td><input class="num nhOut" value="100,000" inputmode="numeric"></td><td class="num nhBal">0</td></tr>
                <tr><td><input class="txt" value="운영비"></td><td><input class="num nhIn" value="0" inputmode="numeric"></td><td><input class="num nhOut" value="11,000,500" inputmode="numeric"></td><td class="num nhBal">0</td></tr>
                <tr><td><input class="txt" value="이자"></td><td><input class="num nhIn" value="5,492" inputmode="numeric"></td><td><input class="num nhOut" value="0" inputmode="numeric"></td><td class="num nhBal">0</td></tr>
                <!-- 빈칸들 -->
                <tr><td><input class="txt" value=""></td><td><input class="num nhIn" value="0" inputmode="numeric"></td><td><input class="num nhOut" value="0" inputmode="numeric"></td><td class="num nhBal">0</td></tr>
                <tr><td><input class="txt" value=""></td><td><input class="num nhIn" value="0" inputmode="numeric"></td><td><input class="num nhOut" value="0" inputmode="numeric"></td><td class="num nhBal">0</td></tr>
                <tr><td><input class="txt" value=""></td><td><input class="num nhIn" value="0" inputmode="numeric"></td><td><input class="num nhOut" value="0" inputmode="numeric"></td><td class="num nhBal">0</td></tr>
                <tr><td><input class="txt" value=""></td><td><input class="num nhIn" value="0" inputmode="numeric"></td><td><input class="num nhOut" value="0" inputmode="numeric"></td><td class="num nhBal">0</td></tr>
              </tbody>
              <tfoot>
                <tr>
                  <th>합&nbsp;&nbsp;계</th>
                  <th class="num" id="nhSumIn">0</th>
                  <th class="num" id="nhSumOut">0</th>
                  <th class="num" id="nhEnd">0</th>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>

        <!-- 통합잔액 -->
        <div class="integrated">
          <div class="integratedTitle">12월 31일 통합잔액</div>
          <div class="integratedVal" id="integratedVal">0</div>
        </div>

        <!-- 하단(테두리 없음) -->
        <div class="footer">
          <div contenteditable="true" id="footerDate">2025년 12월 31일</div>
          <div class="footerRow">
            <div class="companyBig">염전마을주민발전주식회사</div>
            <div class="ceoBig">
              대표이사&nbsp;&nbsp;김&nbsp;진&nbsp;욱
              <!-- 도장(파일 경로를 너 GitHub에 올려놓고 src를 그 주소로 바꾸면 됨) -->
              <img class="stamp" id="stampImg" src="stamp.png" alt="직인">
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    // ===== 숫자 파서/포맷 =====
    const toNum = (v) => {
      if (v == null) return 0;
      const s = String(v).replace(/[^\d\-]/g,'').trim();
      const n = Number(s || 0);
      return Number.isFinite(n) ? n : 0;
    };
    const fmt = (n) => {
      const sign = n < 0 ? "-" : "";
      const abs = Math.abs(Math.trunc(n));
      return sign + abs.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    };
    const bindMoneyInput = (el) => {
      el.addEventListener('input', () => {
        // 입력 중 칸폭 절대 늘어나지 않도록(이미 CSS로 고정)
        // 포맷은 blur에서만
      });
      el.addEventListener('blur', () => {
        el.value = fmt(toNum(el.value));
        recalcAll();
      });
      el.addEventListener('focus', () => {
        // 커서 편하게: 쉼표 제거 후 수정하고 싶으면 아래 주석 해제
        // el.value = String(toNum(el.value));
      });
    };

    // ===== iPhone “한 장 스케일 + 중앙정렬(잘림 방지)” =====
    function fitOneScreen(){
      const wrap = document.documentElement;
      const sheet = document.getElementById('sheet');
      const sheetW = sheet.offsetWidth;
      const sheetH = sheet.offsetHeight;

      const vw = window.innerWidth;
      const vh = window.innerHeight;

      // stage 패딩 고려(대충 20px 양쪽)
      const padX = 20;
      const padY = 24;

      const sW = (vw - padX) / sheetW;
      const sH = (vh - padY) / sheetH;

      const s = Math.min(1, sW, sH);

      // “왼쪽 잘림” 방지 핵심: 스케일된 폭 기준으로 정확히 중앙으로 translate
      const scaledW = sheetW * s;
      const tx = Math.max(0, (vw - scaledW) / 2);

      wrap.style.setProperty('--s', String(s));
      wrap.style.setProperty('--tx', tx + 'px');
    }

    // ===== 계산 로직 =====
    function sumInputs(selector){
      let total = 0;
      document.querySelectorAll(selector).forEach(inp => total += toNum(inp.value));
      return total;
    }

    function calcIncomeExpense(){
      const sumIn = sumInputs('.inAmt');
      const sumOut = sumInputs('.outAmt');
      const net = sumIn - sumOut;

      document.getElementById('sumIn').textContent = fmt(sumIn);
      document.getElementById('sumOut').textContent = fmt(sumOut);
      document.getElementById('netFoot').textContent = fmt(net);

      document.getElementById('net').value = fmt(net);

      const carry = toNum(document.getElementById('carry').value);
      document.getElementById('endBal').value = fmt(carry + net);
    }

    function calcBank(prefix){
      const prev = toNum(document.getElementById(prefix+'Prev').value);

      let bal = prev;
      let sumIn = 0;
      let sumOut = 0;

      const rows = document.querySelectorAll('#'+prefix+'Body tr');
      rows.forEach(r => {
        const inEl = r.querySelector('.'+prefix+'In');
        const outEl = r.querySelector('.'+prefix+'Out');
        const balCell = r.querySelector('.'+prefix+'Bal');

        const inc = inEl ? toNum(inEl.value) : 0;
        const out = outEl ? toNum(outEl.value) : 0;

        sumIn += inc;
        sumOut += out;

        bal = bal + inc - out;
        if (balCell) balCell.textContent = fmt(bal);
      });

      document.getElementById(prefix+'SumIn').textContent = fmt(sumIn);
      document.getElementById(prefix+'SumOut').textContent = fmt(sumOut);
      document.getElementById(prefix+'End').textContent = fmt(bal);

      return bal;
    }

    function recalcAll(){
      // 입력 포맷(쉼표) 반영
      calcIncomeExpense();

      const ibEnd = calcBank('ib');
      const nhEnd = calcBank('nh');

      // 통합잔액 = 기업은행 최종잔액 + 농협 최종잔액
      document.getElementById('integratedVal').textContent = fmt(ibEnd + nhEnd);

      // 높이가 바뀌면 스케일 다시
      fitOneScreen();
    }

    // ===== 초기 바인딩 =====
    function init(){
      // 요약 입력
      bindMoneyInput(document.getElementById('carry'));
      bindMoneyInput(document.getElementById('ibPrev'));
      bindMoneyInput(document.getElementById('nhPrev'));

      // 수입/지출 입력
      document.querySelectorAll('.inAmt,.outAmt').forEach(bindMoneyInput);

      // 은행 입력
      document.querySelectorAll('.ibIn,.ibOut,.nhIn,.nhOut').forEach(bindMoneyInput);

      // stamp.png가 안 뜨면 (GitHub 경로로 바꾸기)
      // 예: document.getElementById('stampImg').src = 'images/stamp.png';

      recalcAll();
      fitOneScreen();
    }

    window.addEventListener('resize', () => { fitOneScreen(); });
    window.addEventListener('orientationchange', () => { setTimeout(fitOneScreen, 200); });
    window.addEventListener('load', init);
  </script>
</body>
</html>
