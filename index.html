<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>결산 보고서</title>

  <style>
    :root{
      --ink:#111;
      --grid:#222;
      --red:#d82222;

      --sheet-w: 920px;
      --pad: 18px;
      --b: 3px;
      --b2: 2px;

      --font: "Apple SD Gothic Neo","Noto Sans KR",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;

      /* 은행표 헤더만 은은하게 */
      --c-in:  #dfe8f6;
      --c-out: #f6ddcf;
      --c-bal: #d7f1ea;
    }

    *{ box-sizing:border-box; }
    html, body{
      margin:0; padding:0;
      background:#f3f4f6;
      font-family:var(--font);
      color:var(--ink);
      width:100%;
      overflow-x:hidden;
      -webkit-text-size-adjust:100%;
      text-size-adjust:100%;
    }

    .stage{
      width:100%;
      padding-top:14px;
      padding-bottom:40px;
      padding-left:calc(10px + env(safe-area-inset-left));
      padding-right:calc(10px + env(safe-area-inset-right));
      overflow-x:hidden;
      position:relative;
    }

    .sheetWrap{
      width:var(--sheet-w);
      position:relative;
      left:50%;
      transform-origin: top center;
      transform: translateX(-50%) scale(var(--scale, 1));
      will-change: transform;
      backface-visibility:hidden;
      -webkit-font-smoothing: antialiased;
    }

    .sheet{
      width:var(--sheet-w);
      background:#fff;
      border:1px solid #d5d7db;
      box-shadow:0 8px 28px rgba(0,0,0,.08);
      padding:var(--pad);
    }

    input{
      width:100%;
      min-width:0;
      max-width:100%;
      border:0;
      outline:0;
      background:transparent;
      font:inherit;
      color:inherit;
      padding:0;
      margin:0;
      display:block;
      -webkit-appearance:none;
      appearance:none;
      border-radius:0;
    }

    .num{
      text-align:right;
      white-space:nowrap;
      font-variant-numeric: tabular-nums;
    }

    table{
      width:100%;
      border-collapse:collapse;
      table-layout:fixed;
    }

    th, td{
      overflow:hidden;
      white-space:nowrap;
      text-overflow:clip;
      vertical-align:middle;
      min-width:0;
    }

    /* ===== 제목 ===== */
    .titleWrap{
      margin:6px 0 14px;
      padding:14px 10px 12px;
      position:relative;
    }
    .titleLineTop,
    .titleLineBot{
      height:6px;
      background:linear-gradient(90deg, #9cff4a 0 44%, #6fdc33 44% 46%, #78e63a 46% 100%);
      border-radius:3px;
    }
    .titleLineTop{ margin:0 0 14px; }
    .titleLineBot{
      margin:14px 0 0;
      background:linear-gradient(90deg, #2f7f2b 0 50%, #5fdd33 50% 52%, #2f7f2b 52% 100%);
    }

    .titleBox{
      border:0;
      padding:10px 14px;
      display:flex;
      justify-content:center;
      align-items:center;
      background:#fff;
    }
    .titleText{
      font-weight:1000;
      -webkit-text-stroke: 1px rgba(0,0,0,.25);
      font-size:56px;
      letter-spacing:-1px;
      line-height:1.02;
      color:#143a63;
      text-shadow: 4px 4px 0 rgba(0,0,0,.18);
      white-space:nowrap;
    }

    /* ===== 요약 3칸 ===== */
    .summary{
      border:var(--b) solid var(--ink);
      margin:6px 0 12px;
    }
    .summaryGrid{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
    }
    .sumCell{ border-right:var(--b) solid var(--ink); }
    .sumCell:last-child{ border-right:0; }

    .sumHead{
      border-bottom:var(--b) solid var(--ink);
      text-align:center;
      font-size:20px;
      padding:10px 8px;
      letter-spacing:2px;
      font-weight:900;
      background:#fff;
    }
    .sumVal{
      font-weight:900;
      font-size:34px;
      padding:14px 10px;
      background:#fff;
    }
    .sumVal.red{ color:var(--red); }
    .sumVal input{
      font-weight:900;
      font-size:34px;
    }
    .sumVal.red input{ color:var(--red); }

    /* ✅ 요약 헤더 한 줄만 색 */
    .sumCell:nth-child(1) .sumHead{ background:#e8f0fb !important; } /* 이월 */
    .sumCell:nth-child(2) .sumHead{ background:#fde9d9 !important; } /* 수입-지출 */
    .sumCell:nth-child(3) .sumHead{ background:#e6f6f2 !important; } /* 잔액 */

    /* ===== 섹션 타이틀 ===== */
    .sectionTitle{
      display:flex;
      align-items:center;
      gap:10px;
      margin:10px 0 8px;
      font-weight:900;
      font-size:22px;
    }
    .dot{
      width:18px; height:18px;
      border:2px solid var(--ink);
      border-radius:50%;
      flex:0 0 auto;
    }
    .editText{
      display:inline-block;
      min-width:10px;
      outline:none;
      cursor:text;
    }

    .noteLine{
      border:var(--b) solid var(--ink);
      padding:8px 10px;
      margin:-2px 0 8px;
      font-size:14px;
      color:#222;
      text-align:center;
      font-weight:800;
    }

    /* ===== 표 공통 ===== */
    .tbl{
      border:var(--b) solid var(--ink);
    }
    .tbl th, .tbl td{
      border:var(--b2) solid var(--grid);
      padding:6px 8px;
      font-size:16px;
    }
    .tbl th{
      background:#f2f2f2;
      text-align:center;
      font-weight:900;
      letter-spacing:2px;
    }
    .tbl .subhead th{
      background:#f7f7f7;
      letter-spacing:1px;
    }

    .center{ text-align:center; }
    .right{ text-align:right; }

    .colDesc{ width:28%; }
    .colAmt{ width:16%; }
    .colDesc2{ width:28%; }
    .colAmt2{ width:16%; }
    .colBigo{ width:12%; }

    /* ✅ 수입/지출: '적요/금액' 헤더 한 줄만 색 */
    #incomeExpenseTable thead tr.subhead th:nth-child(1),
    #incomeExpenseTable thead tr.subhead th:nth-child(2){
      background:#e8f0fb !important;
    }
    #incomeExpenseTable thead tr.subhead th:nth-child(3),
    #incomeExpenseTable thead tr.subhead th:nth-child(4){
      background:#fde9d9 !important;
    }

    /* 본문칸 배경은 깔끔하게 흰색 */
    .cellDesc, .cellAmt{ background:#fff; }

    /* ===== 은행 ===== */
    .bankWrap{
      border:var(--b) solid var(--ink);
      padding:10px;
    }
    .bankTables{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .bankTbl{
      border:var(--b) solid var(--ink);
    }
    .bankTbl th, .bankTbl td{
      border:var(--b2) solid var(--grid);
      padding:6px 6px;
      font-size:14px;
    }
    .bankTopTitle{
      border-bottom:var(--b2) solid var(--grid);
      font-weight:900;
      text-align:center;
      letter-spacing:4px;
      padding:6px 0;
      background:#fff;
    }

    .prevRow{
      display:grid;
      grid-template-columns: 140px 1fr;
      border-bottom:var(--b2) solid var(--grid);
    }
    .prevRow .label{
      background:#f7f7f7;
      border-right:var(--b2) solid var(--grid);
      text-align:center;
      font-weight:900;
      letter-spacing:2px;
      padding:8px 8px;
    }
    .prevRow .val{
      padding:8px 8px;
      font-weight:900;
      text-align:right;
      min-width:0;
    }

    .bankTbl col.desc{ width:28%; }
    .bankTbl col.in{ width:24%; }
    .bankTbl col.out{ width:24%; }
    .bankTbl col.bal{ width:24%; }

    .thIn{ background:var(--c-in) !important; }
    .thOut{ background:var(--c-out) !important; }
    .thBal{ background:var(--c-bal) !important; }

    /* ===== 하단 ===== */
    .integratedBox{
      border:var(--b) solid var(--ink);
      margin-top:10px;
      padding:12px 12px 14px;
      display:flex;
      flex-direction:column;
      gap:10px;
      position:relative;
      min-height:150px;
    }
    .integratedVal{
      width:100%;
      text-align:right;
      font-size:34px;
      font-weight:900;
      color:var(--red);
      white-space:nowrap;
      overflow:hidden;
      line-height:1.05;
    }

    /* ✅ 원하면 숫자 숨김 유지 */
    #integratedBal{ display:none !important; }

    .integratedMeta{
      display:flex;
      flex-direction:column;
      gap:28px;
      padding-top:2px;
    }

    .metaLine1,
    .metaLine2{
      text-align:center;
      font-weight:900;
      color:#143a63;
      text-shadow: 2px 2px 0 rgba(0,0,0,.14);
      letter-spacing:-0.5px;
      font-size:30px;
      line-height:1.02;
      white-space:nowrap;
    }

    /* 도장 */
    .nameLast{
      position:relative;
      display:inline-block;
      z-index:2;
    }
    .ceoStampBig{
      position:absolute;
      width:90px;
      height:90px;
      left:50%;
      top:50%;
      transform:translate(-50%, -50%);
      opacity:0.9;
      pointer-events:none;
      z-index:1;
    }

    .signLine{
      font-weight:1000;
      font-size:40px;
      color:#143a63;
      letter-spacing:-0.5px;
      line-height:1.02;
      white-space:nowrap;
    }

    /* ✅ 모든 금액 오른쪽 끝 정렬 */
    input.num, input.money{ text-align:right !important; padding-right:0 !important; }
    .sumVal, .sumVal input{ text-align:right !important; padding-right:12px !important; }

    @media print{
      body{ background:#fff; }
      .stage{ padding:0; }
      .sheet{ border:0; box-shadow:none; }
      .sheetWrap{ transform: translateX(-50%) scale(1) !important; }
    }
  </style>
</head>

<body>
  <div class="stage">
    <div class="sheetWrap" id="sheetWrap">
      <div class="sheet" id="sheet">

        <div class="titleWrap">
          <div class="titleLineTop"></div>
          <div class="titleBox">
            <div class="titleText editText" id="reportTitle" contenteditable="true"></div>
          </div>
          <div class="titleLineBot"></div>
        </div>

        <div class="summary">
          <div class="summaryGrid">
            <div class="sumCell">
              <div class="sumHead">
                <span class="editText" contenteditable="true" id="carryLabel">11월 이월금액</span>
              </div>
              <div class="sumVal">
                <input id="carry" class="num money" inputmode="numeric" value="25,554,575">
              </div>
            </div>

            <div class="sumCell">
              <div class="sumHead">
                <span class="editText" contenteditable="true">수 입 - 지 출</span>
              </div>
              <div class="sumVal">
                <input id="net" class="num" value="0" readonly>
              </div>
            </div>

            <div class="sumCell">
              <div class="sumHead">
                <span class="editText" contenteditable="true" id="endBalLabel">12월 31일 통 장 잔 액</span>
              </div>
              <div class="sumVal red">
                <input id="endBal" class="num" value="0" readonly>
              </div>
            </div>
          </div>
        </div>

        <div class="sectionTitle">
          <span class="dot"></span>
          <span class="editText" contenteditable="true" id="titleIncomeExpense">12월 수입/지출 내역서</span>
        </div>

        <div class="noteLine">
          <span class="editText" contenteditable="true">（ 수입은 한달전 생산된 금액입니다. 한달지연 입금됩니다 ）</span>
        </div>

        <table class="tbl" id="incomeExpenseTable">
          <colgroup>
            <col class="colDesc"><col class="colAmt">
            <col class="colDesc2"><col class="colAmt2">
            <col class="colBigo">
          </colgroup>
          <thead>
            <tr>
              <th colspan="2">수&nbsp;&nbsp;입</th>
              <th colspan="2">지&nbsp;&nbsp;출</th>
              <th>비&nbsp;&nbsp;고</th>
            </tr>
            <tr class="subhead">
              <th class="center">적&nbsp;&nbsp;요</th>
              <th class="center">금&nbsp;&nbsp;액</th>
              <th class="center">적&nbsp;&nbsp;요</th>
              <th class="center">금&nbsp;&nbsp;액</th>
              <th class="center"></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="cellDesc"><input value="1차 SMP"></td>
              <td class="cellAmt"><input class="num money inc" inputmode="numeric" value="0"></td>
              <td class="cellDesc"><input value="송전료"></td>
              <td class="cellAmt"><input class="num money exp" inputmode="numeric" value="0"></td>
              <td><input value=""></td>
            </tr>
            <tr>
              <td class="cellDesc"><input value="2차 SMP"></td>
              <td class="cellAmt"><input class="num money inc" inputmode="numeric" value="0"></td>
              <td class="cellDesc"><input value="이사회식대"></td>
              <td class="cellAmt"><input class="num money exp" inputmode="numeric" value="0"></td>
              <td><input value=""></td>
            </tr>
            <tr>
              <td class="cellDesc"><input value="3차 SMP"></td>
              <td class="cellAmt"><input class="num money inc" inputmode="numeric" value="0"></td>
              <td class="cellDesc"><input value="사람과사람세무사"></td>
              <td class="cellAmt"><input class="num money exp" inputmode="numeric" value="0"></td>
              <td><input value=""></td>
            </tr>
            <tr>
              <td class="cellDesc"><input value="4차 SMP"></td>
              <td class="cellAmt"><input class="num money inc" inputmode="numeric" value="0"></td>
              <td class="cellDesc"><input value="보상금"></td>
              <td class="cellAmt"><input class="num money exp" inputmode="numeric" value="0"></td>
              <td><input value=""></td>
            </tr>
            <tr>
              <td class="cellDesc"><input value="KT 전력예측"></td>
              <td class="cellAmt"><input class="num money inc" inputmode="numeric" value="0"></td>
              <td class="cellDesc"><input value="대표,이사회수당"></td>
              <td class="cellAmt"><input class="num money exp" inputmode="numeric" value="0"></td>
              <td><input value=""></td>
            </tr>
            <tr>
              <td class="cellDesc"><input value="rec"></td>
              <td class="cellAmt"><input class="num money inc" inputmode="numeric" value="0"></td>
              <td class="cellDesc"><input value="군청근조화환"></td>
              <td class="cellAmt"><input class="num money exp" inputmode="numeric" value="0"></td>
              <td><input value=""></td>
            </tr>
            <tr>
              <td class="cellDesc"><input value="이자"></td>
              <td class="cellAmt"><input class="num money inc" inputmode="numeric" value="0"></td>
              <td class="cellDesc"><input value="이음북스"></td>
              <td class="cellAmt"><input class="num money exp" inputmode="numeric" value="0"></td>
              <td><input value=""></td>
            </tr>
            <tr>
              <td class="cellDesc"><input value="이자"></td>
              <td class="cellAmt"><input class="num money inc" inputmode="numeric" value="0"></td>
              <td class="cellDesc"><input value="토지임대료"></td>
              <td class="cellAmt"><input class="num money exp" inputmode="numeric" value="0"></td>
              <td><input value=""></td>
            </tr>
            <tr>
              <td class="cellDesc"><input value=""></td>
              <td class="cellAmt"><input class="num money inc" inputmode="numeric" value="0"></td>
              <td class="cellDesc"><input value="운영비"></td>
              <td class="cellAmt"><input class="num money exp" inputmode="numeric" value="0"></td>
              <td><input value=""></td>
            </tr>

            <tr><td class="cellDesc"><input value=""></td><td class="cellAmt"><input class="num money inc" inputmode="numeric" value="0"></td><td class="cellDesc"><input value=""></td><td class="cellAmt"><input class="num money exp" inputmode="numeric" value="0"></td><td><input value=""></td></tr>
            <tr><td class="cellDesc"><input value=""></td><td class="cellAmt"><input class="num money inc" inputmode="numeric" value="0"></td><td class="cellDesc"><input value=""></td><td class="cellAmt"><input class="num money exp" inputmode="numeric" value="0"></td><td><input value=""></td></tr>
            <tr><td class="cellDesc"><input value=""></td><td class="cellAmt"><input class="num money inc" inputmode="numeric" value="0"></td><td class="cellDesc"><input value=""></td><td class="cellAmt"><input class="num money exp" inputmode="numeric" value="0"></td><td><input value=""></td></tr>
          </tbody>
          <tfoot>
            <tr>
              <th class="center">합&nbsp;&nbsp;계</th>
              <th class="right"><input id="incSum" class="num" readonly value="0"></th>
              <th class="center">합&nbsp;&nbsp;계</th>
              <th class="right"><input id="expSum" class="num" readonly value="0"></th>
              <th class="right"><input id="netFoot" class="num" readonly value="0"></th>
            </tr>
          </tfoot>
        </table>

        <div class="sectionTitle" style="margin-top:14px;">
          <span class="dot"></span>
          <span class="editText" contenteditable="true" id="titleBank">12월 은행 입출금 내역</span>
        </div>

        <div class="bankWrap">
          <div class="bankTables">

            <div>
              <div class="bankTopTitle"><span class="editText" contenteditable="true">기 업 은 행</span></div>
              <div class="prevRow">
                <div class="label"><span class="editText" contenteditable="true">전월이월액</span></div>
                <div class="val"><input id="ibPrev" class="num money" inputmode="numeric" value="15,541,634"></div>
              </div>

              <table class="bankTbl" id="ibTable">
                <colgroup><col class="desc"><col class="in"><col class="out"><col class="bal"></colgroup>
                <thead>
                  <tr>
                    <th class="center">적&nbsp;&nbsp;요</th>
                    <th class="center thIn">입&nbsp;&nbsp;금</th>
                    <th class="center thOut">출&nbsp;&nbsp;금</th>
                    <th class="center thBal">잔&nbsp;&nbsp;액</th>
                  </tr>
                </thead>
                <tbody>
                  <tr><td class="cellDesc"><input value="전력거래소"></td><td class="cellAmt"><input class="num money ib-in" inputmode="numeric" value="0"></td><td class="cellAmt"><input class="num money ib-out" inputmode="numeric" value="0"></td><td><input class="num ib-bal" readonly></td></tr>
                  <tr><td class="cellDesc"><input value="염전마을주"></td><td class="cellAmt"><input class="num money ib-in" inputmode="numeric" value="0"></td><td class="cellAmt"><input class="num money ib-out" inputmode="numeric" value="0"></td><td><input class="num ib-bal" readonly></td></tr>
                  <tr><td class="cellDesc"><input value="이자"></td><td class="cellAmt"><input class="num money ib-in" inputmode="numeric" value="0"></td><td class="cellAmt"><input class="num money ib-out" inputmode="numeric" value="0"></td><td><input class="num ib-bal" readonly></td></tr>
                  <tr><td class="cellDesc"><input value="전력거래소"></td><td class="cellAmt"><input class="num money ib-in" inputmode="numeric" value="0"></td><td class="cellAmt"><input class="num money ib-out" inputmode="numeric" value="0"></td><td><input class="num ib-bal" readonly></td></tr>
                  <tr><td class="cellDesc"><input value="전력거래소"></td><td class="cellAmt"><input class="num money ib-in" inputmode="numeric" value="0"></td><td class="cellAmt"><input class="num money ib-out" inputmode="numeric" value="0"></td><td><input class="num ib-bal" readonly></td></tr>
                  <tr><td class="cellDesc"><input value="염전마을주"></td><td class="cellAmt"><input class="num money ib-in" inputmode="numeric" value="0"></td><td class="cellAmt"><input class="num money ib-out" inputmode="numeric" value="0"></td><td><input class="num ib-bal" readonly></td></tr>
                  <tr><td class="cellDesc"><input value="전력거래소"></td><td class="cellAmt"><input class="num money ib-in" inputmode="numeric" value="0"></td><td class="cellAmt"><input class="num money ib-out" inputmode="numeric" value="0"></td><td><input class="num ib-bal" readonly></td></tr>

                  <tr><td class="cellDesc"><input value=""></td><td class="cellAmt"><input class="num money ib-in" inputmode="numeric" value="0"></td><td class="cellAmt"><input class="num money ib-out" inputmode="numeric" value="0"></td><td><input class="num ib-bal" readonly></td></tr>
                  <tr><td class="cellDesc"><input value=""></td><td class="cellAmt"><input class="num money ib-in" inputmode="numeric" value="0"></td><td class="cellAmt"><input class="num money ib-out" inputmode="numeric" value="0"></td><td><input class="num ib-bal" readonly></td></tr>
                  <tr><td class="cellDesc"><input value=""></td><td class="cellAmt"><input class="num money ib-in" inputmode="numeric" value="0"></td><td class="cellAmt"><input class="num money ib-out" inputmode="numeric" value="0"></td><td><input class="num ib-bal" readonly></td></tr>
                </tbody>
                <tfoot>
                  <tr>
                    <th class="center">합&nbsp;&nbsp;계</th>
                    <th class="right"><input id="ibInSum" class="num" readonly></th>
                    <th class="right"><input id="ibOutSum" class="num" readonly></th>
                    <th class="right"><input id="ibEnd" class="num" readonly></th>
                  </tr>
                </tfoot>
              </table>
            </div>

            <div>
              <div class="bankTopTitle"><span class="editText" contenteditable="true">농&nbsp;&nbsp;협</span></div>
              <div class="prevRow">
                <div class="label"><span class="editText" contenteditable="true">전월이월액</span></div>
                <div class="val"><input id="nhPrev" class="num money" inputmode="numeric" value="10,012,941"></div>
              </div>

              <table class="bankTbl" id="nhTable">
                <colgroup><col class="desc"><col class="in"><col class="out"><col class="bal"></colgroup>
                <thead>
                  <tr>
                    <th class="center">적&nbsp;&nbsp;요</th>
                    <th class="center thIn">입&nbsp;&nbsp;금</th>
                    <th class="center thOut">출&nbsp;&nbsp;금</th>
                    <th class="center thBal">잔&nbsp;&nbsp;액</th>
                  </tr>
                </thead>
                <tbody>
                  <tr><td class="cellDesc"><input value="이음북스"></td><td class="cellAmt"><input class="num money nh-in" inputmode="numeric" value="0"></td><td class="cellAmt"><input class="num money nh-out" inputmode="numeric" value="0"></td><td><input class="num nh-bal" readonly></td></tr>
                  <tr><td class="cellDesc"><input value="이사회식대"></td><td class="cellAmt"><input class="num money nh-in" inputmode="numeric" value="0"></td><td class="cellAmt"><input class="num money nh-out" inputmode="numeric" value="0"></td><td><input class="num nh-bal" readonly></td></tr>
                  <tr><td class="cellDesc"><input value="염전마을주"></td><td class="cellAmt"><input class="num money nh-in" inputmode="numeric" value="0"></td><td class="cellAmt"><input class="num money nh-out" inputmode="numeric" value="0"></td><td><input class="num nh-bal" readonly></td></tr>
                  <tr><td class="cellDesc"><input value="송전료"></td><td class="cellAmt"><input class="num money nh-in" inputmode="numeric" value="0"></td><td class="cellAmt"><input class="num money nh-out" inputmode="numeric" value="0"></td><td><input class="num nh-bal" readonly></td></tr>
                  <tr><td class="cellDesc"><input value="김균태회계"></td><td class="cellAmt"><input class="num money nh-in" inputmode="numeric" value="0"></td><td class="cellAmt"><input class="num money nh-out" inputmode="numeric" value="0"></td><td><input class="num nh-bal" readonly></td></tr>
                  <tr><td class="cellDesc"><input value="보상금"></td><td class="cellAmt"><input class="num money nh-in" inputmode="numeric" value="0"></td><td class="cellAmt"><input class="num money nh-out" inputmode="numeric" value="0"></td><td><input class="num nh-bal" readonly></td></tr>
                  <tr><td class="cellDesc"><input value="대표,이사회수당"></td><td class="cellAmt"><input class="num money nh-in" inputmode="numeric" value="0"></td><td class="cellAmt"><input class="num money nh-out" inputmode="numeric" value="0"></td><td><input class="num nh-bal" readonly></td></tr>

                  <tr><td class="cellDesc"><input value=""></td><td class="cellAmt"><input class="num money nh-in" inputmode="numeric" value="0"></td><td class="cellAmt"><input class="num money nh-out" inputmode="numeric" value="0"></td><td><input class="num nh-bal" readonly></td></tr>
                  <tr><td class="cellDesc"><input value=""></td><td class="cellAmt"><input class="num money nh-in" inputmode="numeric" value="0"></td><td class="cellAmt"><input class="num money nh-out" inputmode="numeric" value="0"></td><td><input class="num nh-bal" readonly></td></tr>
                  <tr><td class="cellDesc"><input value=""></td><td class="cellAmt"><input class="num money nh-in" inputmode="numeric" value="0"></td><td class="cellAmt"><input class="num money nh-out" inputmode="numeric" value="0"></td><td><input class="num nh-bal" readonly></td></tr>
                </tbody>
                <tfoot>
                  <tr>
                    <th class="center">합&nbsp;&nbsp;계</th>
                    <th class="right"><input id="nhInSum" class="num" readonly></th>
                    <th class="right"><input id="nhOutSum" class="num" readonly></th>
                    <th class="right"><input id="nhEnd" class="num" readonly></th>
                  </tr>
                </tfoot>
              </table>
            </div>

          </div>
        </div>

        <div class="integratedBox">
          <div class="integratedVal" id="integratedBal">0</div>

          <div class="integratedMeta">
            <div class="metaLine1">
              <span class="editText" id="reportDate" contenteditable="true"></span>
            </div>

            <div class="metaLine2">
              <span class="editText signLine" contenteditable="true">
                염전마을주민발전주식회사&nbsp;&nbsp;대표이사&nbsp;&nbsp;
                김&nbsp;&nbsp;진&nbsp;&nbsp;
                <span class="nameLast">
                  욱
                  <img src="stamp.PNG" class="ceoStampBig" alt="직인">
                </span>
              </span>
            </div>
          </div>
        </div>
<script>
(function(){
  "use strict";

  /* =========================
     0) 결산월(전월) 기준 월키
     ========================= */
  function getClosingMonthKey(){
    const now = new Date();
    let y = now.getFullYear();
    let m = now.getMonth(); // 0~11 (현재월)
    // 결산은 "전월"
    m -= 1;
    if(m < 0){ m = 11; y -= 1; }
    const mm = String(m+1).padStart(2,"0");
    return `${y}-${mm}`;
  }

  const STORAGE_PREFIX = "settlement_report_v1";
  const monthKey = getClosingMonthKey();
  const STORAGE_KEY = `${STORAGE_PREFIX}:${monthKey}`;
  const STORAGE_MONTH_KEY = `${STORAGE_PREFIX}:savedMonth`;

  /* =========================
     1) 유틸
     ========================= */
  const $ = (sel, root=document) => root.querySelector(sel);
  const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

  function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

  function parseMoney(v){
    if(v == null) return 0;
    const s = String(v).replace(/[^\d\-]/g,"").trim();
    if(s === "" || s === "-" ) return 0;
    const n = Number(s);
    return Number.isFinite(n) ? n : 0;
  }

  function fmtMoney(n){
    const sign = n < 0 ? "-" : "";
    const abs = Math.abs(Math.round(n));
    return sign + abs.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  }

  function setInputMoney(el, n){
    el.value = fmtMoney(n);
  }

  function normalizeMoneyInput(el){
    const n = parseMoney(el.value);
    el.value = fmtMoney(n);
  }

  /* =========================
     2) iPhone 한 장 scale
     ========================= */
  function applyScale(){
    const wrap = $("#sheetWrap");
    if(!wrap) return;
    const sheetW = 920; // --sheet-w
    const available = Math.max(320, window.innerWidth - 24); // 양쪽 여백
    const s = clamp(available / sheetW, 0.33, 1);
    wrap.style.setProperty("--scale", String(s));
  }

  window.addEventListener("resize", applyScale, {passive:true});
  applyScale();

  /* =========================
     3) 제목/날짜 자동 세팅
     ========================= */
  function setDefaultTitleAndDate(){
    const titleEl = $("#reportTitle");
    const dateEl  = $("#reportDate");
    if(!titleEl || !dateEl) return;

    // 결산월(전월) 계산
    const [yy, mm] = monthKey.split("-");
    const year = Number(yy);
    const month = Number(mm);

    // 제목
    if(!titleEl.textContent || titleEl.textContent.trim() === ""){
      titleEl.textContent = `${year}년 ${month}월 결산 보고서`;
    }

    // 날짜 기본값 (결산월 말일)
    if(!dateEl.textContent || dateEl.textContent.trim() === ""){
      const lastDay = new Date(year, month, 0).getDate(); // month는 1~12로 들어가면 그 전월 말일
      dateEl.textContent = `${year}년 ${month}월 ${lastDay}일`;
    }

    // 라벨들도 결산월로 맞춰줌(기본값만)
    const carryLabel = $("#carryLabel");
    const endBalLabel = $("#endBalLabel");
    const titleIncomeExpense = $("#titleIncomeExpense");
    const titleBank = $("#titleBank");

    if(carryLabel && carryLabel.textContent.trim() === "11월 이월금액"){
      // 결산월의 전전월이 이월(예: 12월 결산이면 11월 이월)
      let cy = year, cm = month - 1;
      if(cm <= 0){ cm = 12; cy -= 1; }
      carryLabel.textContent = `${cm}월 이월금액`;
    }

    if(endBalLabel && endBalLabel.textContent.replace(/\s/g,"").includes("12월31일통장잔액")){
      endBalLabel.textContent = `${month}월 31일 통 장 잔 액`;
    }

    if(titleIncomeExpense && titleIncomeExpense.textContent.trim() === "12월 수입/지출 내역서"){
      titleIncomeExpense.textContent = `${month}월 수입/지출 내역서`;
    }

    if(titleBank && titleBank.textContent.trim() === "12월 은행 입출금 내역"){
      titleBank.textContent = `${month}월 은행 입출금 내역`;
    }
  }

  setDefaultTitleAndDate();

  /* =========================
     4) 합계/자동계산
     ========================= */
  function calcIncomeExpense(){
    const incEls = $$(".inc");
    const expEls = $$(".exp");

    let incSum = 0;
    let expSum = 0;

    for(const el of incEls) incSum += parseMoney(el.value);
    for(const el of expEls) expSum += parseMoney(el.value);

    const net = incSum - expSum;

    $("#incSum").value = fmtMoney(incSum);
    $("#expSum").value = fmtMoney(expSum);
    $("#netFoot").value = fmtMoney(net);
    $("#net").value = fmtMoney(net);

    // 12/31 잔액 = 이월 + (수입-지출)
    const carry = parseMoney($("#carry").value);
    const endBal = carry + net;
    $("#endBal").value = fmtMoney(endBal);
  }

  function calcBankOne(prevId, inSel, outSel, balSel, inSumId, outSumId, endId){
    const prev = parseMoney($(prevId).value);
    const ins = $$(inSel);
    const outs = $$(outSel);
    const bals = $$(balSel);

    let bal = prev;
    let inSum = 0;
    let outSum = 0;

    for(let i=0;i<Math.max(ins.length, outs.length, bals.length);i++){
      const inEl = ins[i];
      const outEl = outs[i];
      const balEl = bals[i];

      const vin  = inEl ? parseMoney(inEl.value) : 0;
      const vout = outEl ? parseMoney(outEl.value) : 0;

      inSum += vin;
      outSum += vout;

      bal = bal + vin - vout;
      if(balEl) balEl.value = fmtMoney(bal);
    }

    $(inSumId).value = fmtMoney(inSum);
    $(outSumId).value = fmtMoney(outSum);
    $(endId).value = fmtMoney(bal);

    return bal;
  }

  function calcAll(){
    calcIncomeExpense();

    const ibEnd = calcBankOne("#ibPrev", ".ib-in", ".ib-out", ".ib-bal", "#ibInSum", "#ibOutSum", "#ibEnd");
    const nhEnd = calcBankOne("#nhPrev", ".nh-in", ".nh-out", ".nh-bal", "#nhInSum", "#nhOutSum", "#nhEnd");

    // 통합잔액(기업+농협 최종)
    const integrated = ibEnd + nhEnd;
    const integratedEl = $("#integratedBal");
    if(integratedEl) integratedEl.textContent = fmtMoney(integrated);

    saveNow(); // 계산될 때마다 저장
  }

  /* =========================
     5) 저장/복원 (결산월 기준)
     ========================= */
  function snapshot(){
    const data = {};

    // input 값
    $$("input").forEach((el, idx)=>{
      // readonly도 포함해서 저장(복원시 동일)
      const key = el.id ? `#${el.id}` : `input:${idx}`;
      data[key] = el.value;
    });

    // contenteditable 텍스트
    $$(".editText[contenteditable='true']").forEach((el, idx)=>{
      const key = el.id ? `ce#${el.id}` : `ce:${idx}`;
      data[key] = el.textContent;
    });

    return data;
  }

  function restore(data){
    if(!data) return;

    $$("input").forEach((el, idx)=>{
      const key = el.id ? `#${el.id}` : `input:${idx}`;
      if(Object.prototype.hasOwnProperty.call(data, key)){
        el.value = data[key];
      }
    });

    $$(".editText[contenteditable='true']").forEach((el, idx)=>{
      const key = el.id ? `ce#${el.id}` : `ce:${idx}`;
      if(Object.prototype.hasOwnProperty.call(data, key)){
        el.textContent = data[key];
      }
    });
  }

  function ensureMonth(){
    const savedMonth = localStorage.getItem(STORAGE_MONTH_KEY);

    // 1) 최초 실행이면: 지금 결산월로 세팅하고 기본 스냅샷 저장
    if(!savedMonth){
      localStorage.setItem(STORAGE_MONTH_KEY, monthKey);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(snapshot()));
      return;
    }

    // 2) savedMonth와 현재 결산월이 다르면: 새 결산월로 초기화(자동)
    if(savedMonth !== monthKey){
      // 기존 키들 정리(선택)
      // 이전 달 데이터는 남기고 싶으면 아래 2줄 주석처리
      Object.keys(localStorage).forEach(k=>{
        if(k.startsWith(STORAGE_PREFIX + ":") && k !== STORAGE_MONTH_KEY){
          localStorage.removeItem(k);
        }
      });

      localStorage.setItem(STORAGE_MONTH_KEY, monthKey);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(snapshot()));
    }
  }

  function saveNow(){
    try{
      localStorage.setItem(STORAGE_KEY, JSON.stringify(snapshot()));
    }catch(e){
      // 저장공간 부족 등 — 조용히 무시
    }
  }

  function loadNow(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return false;
      const data = JSON.parse(raw);
      restore(data);
      return true;
    }catch(e){
      return false;
    }
  }

  /* =========================
     6) 이벤트 바인딩
     ========================= */
  function bindMoneyFormatting(){
    const moneyInputs = $$(".money");
    moneyInputs.forEach(el=>{
      el.addEventListener("focus", ()=>{}, {passive:true});
      el.addEventListener("blur", ()=>{
        normalizeMoneyInput(el);
        calcAll();
      }, {passive:true});
      el.addEventListener("input", ()=>{
        // 입력 중엔 콤마 강제X(커서 튐 방지) -> 계산만
        calcAll();
      }, {passive:true});
    });

    // money가 아닌 일반 input도 저장
    $$("input:not(.money)").forEach(el=>{
      el.addEventListener("input", ()=>{
        saveNow();
      }, {passive:true});
    });
  }

  function bindEditableSaving(){
    $$(".editText[contenteditable='true']").forEach(el=>{
      el.addEventListener("input", ()=>{
        saveNow();
      }, {passive:true});
      el.addEventListener("blur", ()=>{
        saveNow();
      }, {passive:true});
    });
  }

  /* =========================
     7) 시작 시퀀스
     ========================= */
  ensureMonth();
  const loaded = loadNow();

  // 로드 못했으면 기본값 기반 한번 저장(새로고침 안정감)
  if(!loaded){
    saveNow();
  }

  // 로드 후 숫자 정리(콤마/자동계산)
  // money 입력은 한번 정규화
  $$(".money").forEach(el=> normalizeMoneyInput(el));
  bindMoneyFormatting();
  bindEditableSaving();

  // 처음 계산 한번 돌려서 잔액/합계 채우기
  calcAll();

})();
</script>

      </div>
    </div>
  </div>
</body>
</html>






