<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>2025년 12월 결산 보고서</title>
  <style>
    :root{
      --ink:#111;
      --grid:#222;
      --muted:#666;
      --red:#d82222;
      --paper:#fff;
      --bg:#f3f4f6;

      /* “한 장” 기준 폭 */
      --sheet-w: 900px;
      --sheet-pad: 18px;

      --b: 3px;   /* 굵은 테두리 */
      --b2: 2px;  /* 표 테두리 */

      --font: "Apple SD Gothic Neo","Noto Sans KR",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;

      /* 은행 헤더 색(캡처 느낌) */
      --c-in:#dfe8fb;   /* 입금 */
      --c-out:#fde6d7;  /* 출금 */
      --c-bal:#d9f1e6;  /* 잔액 */
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      background:var(--bg);
      font-family:var(--font);
      color:var(--ink);
    }

    /* ===== iPhone에서 “사진처럼 한 장으로” ===== */
    .stage{
      display:flex;
      justify-content:center;
      padding:14px 8px 40px;
    }
    .sheetWrap{
      width:var(--sheet-w);
      transform-origin: top center;
      transform: scale(var(--scale, 1));
    }
    .sheet{
      width:var(--sheet-w);
      background:var(--paper);
      border:1px solid #d5d7db;
      box-shadow:0 8px 28px rgba(0,0,0,.08);
      padding:var(--sheet-pad);
    }

    /* ===== “입력칸처럼 보이지 않게” ===== */
    [contenteditable="true"]{ outline:none; cursor:text; }
    .plainInput{
      width:100%;
      border:0;
      outline:none;
      background:transparent;
      font:inherit;
      color:inherit;
      padding:0;
      margin:0;
      min-width:0;
    }
    .numInput{
      text-align:right;
      font-variant-numeric: tabular-nums;
      letter-spacing:0;
      white-space:nowrap;
      overflow:visible;
      text-overflow:clip;
    }

    /* ===== 제목(정중앙) ===== */
    .title{
      text-align:center;
      font-weight:900;
      font-size:56px;
      letter-spacing:-1px;
      margin:6px 0 14px;
      color:#143a63;
      line-height:1.02;
    }

    /* ===== 상단 로고/대표사인/직인 영역: 전부 삭제(요구사항) ===== */
    .topImagesGone{ display:none; }

    /* ===== 상단 요약 3칸 ===== */
    .summary{
      border:var(--b) solid var(--ink);
      margin:8px 0 14px;
    }
    .summaryGrid{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
    }
    .sumCell{
      border-right:var(--b) solid var(--ink);
    }
    .sumCell:last-child{ border-right:0; }
    .sumHead{
      border-bottom:var(--b) solid var(--ink);
      text-align:center;
      font-size:20px;
      padding:10px 8px;
      letter-spacing:2px;
      font-weight:900;
    }
    .sumVal{
      text-align:center;
      font-weight:900;
      font-size:36px;
      padding:14px 10px;
    }
    .sumVal .plainInput{
      font-weight:900;
      font-size:36px;
      text-align:center;
    }
    .sumVal.red{ color:var(--red); }
    .sumVal.red .plainInput{ color:var(--red); }

    /* ✅ 캡처에 있는 “작은 설명줄( * 이월금액 + … )”은 숨김 */
    .sumFoot{ display:none; }

    /* ===== 섹션 타이틀(원형) ===== */
    .sectionTitle{
      display:flex;
      align-items:center;
      gap:10px;
      margin:10px 0 8px;
      font-weight:900;
      font-size:22px;
    }
    .dot{
      width:18px; height:18px;
      border:2px solid var(--ink);
      border-radius:50%;
      flex:0 0 auto;
    }

    /* ===== 표 공통 ===== */
    table{
      width:100%;
      border-collapse:collapse;
      table-layout:fixed;
    }
    .tbl{
      border:var(--b) solid var(--ink);
    }
    .tbl th, .tbl td{
      border:var(--b2) solid var(--grid);
      padding:6px 8px;
      font-size:16px;
      vertical-align:middle;
    }
    .tbl th{
      background:#f2f2f2;
      text-align:center;
      font-weight:900;
      letter-spacing:2px;
    }
    .center{ text-align:center; }
    .right{ text-align:right; }
    .bold{ font-weight:900; }

    /* 12월 수입/지출 안내줄 */
    .noteLine{
      border:var(--b) solid var(--ink);
      padding:8px 10px;
      margin:-2px 0 8px;
      font-size:14px;
      color:#222;
      text-align:center;
      font-weight:700;
    }

    /* 수입/지출 표 열폭(캡처 느낌) */
    .incomeExpense col.desc{ width:34%; }
    .incomeExpense col.amt { width:14%; }
    .incomeExpense col.desc2{ width:34%; }
    .incomeExpense col.amt2{ width:14%; }
    .incomeExpense col.bigo{ width:14%; }

    /* 수입/지출 헤더에 약간 색 */
    .hIncome{ background:#f2f2f2; }
    .hExpense{ background:#f2f2f2; }
    .hBigo{ background:#f2f2f2; }

    /* ===== 은행 영역 (통장잔액 “별도 컬럼” 삭제 + 기업/농협 넓힘) ===== */
    .bankWrap{
      border:var(--b) solid var(--ink);
      padding:10px;
    }

    .bankTables{
      display:grid;
      grid-template-columns: 1fr 1fr; /* ✅ 통장잔액 컬럼 자체 없음 */
      gap:10px;
      align-items:start;
    }

    .bankCardTitle{
      border:var(--b) solid var(--ink);
      text-align:center;
      font-weight:900;
      padding:6px 0;
      letter-spacing:6px;
      font-size:18px;
      margin-bottom:6px;
    }

    .bankTbl{
      border:var(--b) solid var(--ink);
      table-layout:fixed;
      width:100%;
    }
    .bankTbl th, .bankTbl td{
      border:var(--b2) solid var(--grid);
      padding:5px 6px;       /* ✅ 잘림 방지: padding 축소 */
      font-size:14px;        /* ✅ 잘림 방지: 폰트 약간 축소 */
      line-height:1.15;
      vertical-align:middle;
    }
    .bankTbl th{
      background:#f2f2f2;
      text-align:center;
      font-weight:900;
      letter-spacing:2px;
      white-space:nowrap;
    }

    /* ✅ 전월이월액 줄 */
    .prevRow{
      display:grid;
      grid-template-columns: 160px 1fr;
      border-bottom:var(--b2) solid var(--grid);
    }
    .prevRow > div{ padding:8px 8px; font-weight:900; }
    .prevRow .label{
      background:#f7f7f7;
      border-right:var(--b2) solid var(--grid);
      text-align:center;
      letter-spacing:2px;
      white-space:nowrap;
    }

    /* ✅ 은행 헤더 색(캡처처럼) */
    .bankTbl th.hIn{ background:var(--c-in); }
    .bankTbl th.hOut{ background:var(--c-out); }
    .bankTbl th.hBal{ background:var(--c-bal); }

    /* ✅ 숫자 절대 안 잘리게 */
    .bankTbl td.num,
    .bankTbl td.right,
    .bankTbl td .numInput{
      white-space:nowrap;
      overflow:visible;
      text-overflow:clip;
      font-variant-numeric: tabular-nums;
    }

    /* ✅ 적요 조금 줄이고, 입금/출금/잔액 넓힘 */
    .bankTbl col.desc{ width:30%; }
    .bankTbl col.in  { width:23%; }
    .bankTbl col.out { width:23%; }
    .bankTbl col.bal { width:24%; }

    /* 합계 줄 */
    .sumRow td{
      font-weight:900;
      background:#fafafa;
    }

    /* 통합잔액 박스(하단 1칸만 유지) */
    .integratedBox{
      border:var(--b) solid var(--ink);
      margin-top:10px;
      padding:10px 12px;
      display:flex;
      flex-direction:column;
      gap:6px;
      align-items:flex-start;
    }
    .integratedTitle{
      font-weight:900;
      letter-spacing:2px;
      font-size:16px;
    }
    .integratedVal{
      width:100%;
      text-align:right;
      font-size:34px;
      font-weight:900;
      color:var(--red);
      white-space:nowrap;
    }

    /* ===== 하단(테두리 전부 제거) ===== */
    .bottomDate{
      margin:14px 0 6px;
      padding:0;
      text-align:center;
      font-weight:900;
      letter-spacing:2px;
      border:0;              /* ✅ 제거 */
    }
    .bottomRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      align-items:center;
      margin-top:6px;
    }
    .bottomText{
      text-align:center;
      font-weight:900;
      letter-spacing:2px;
      border:0;              /* ✅ 제거 */
      padding:0;             /* ✅ 제거 */
    }

    /* 프린트 */
    @media print{
      body{ background:#fff; }
      .stage{ padding:0; }
      .sheet{ border:0; box-shadow:none; }
      .sheetWrap{ transform:none !important; }
    }
  </style>
</head>

<body>
  <div class="stage">
    <div class="sheetWrap" id="sheetWrap">
      <div class="sheet" id="sheet">

        <!-- ✅ 제목 정중앙 -->
        <div class="title" contenteditable="true">2025년&nbsp;&nbsp;12월&nbsp;&nbsp;결산&nbsp;보고서</div>

        <!-- ✅ 상단 로고/대표사인/직인 영역 완전 삭제(요구사항) -->
        <div class="topImagesGone"></div>

        <!-- ✅ 상단 요약 3칸 -->
        <div class="summary">
          <div class="summaryGrid">
            <div class="sumCell">
              <div class="sumHead" contenteditable="true">12월&nbsp;이월금액</div>
              <div class="sumVal">
                <input id="carry" class="plainInput numInput" value="25,554,575" />
              </div>
            </div>
            <div class="sumCell">
              <div class="sumHead" contenteditable="true">수&nbsp;입&nbsp;-&nbsp;지&nbsp;출</div>
              <div class="sumVal">
                <input id="net" class="plainInput numInput" value="0" readonly />
              </div>
              <div class="sumFoot">* 숨김</div>
            </div>
            <div class="sumCell">
              <div class="sumHead" contenteditable="true">12월&nbsp;31일&nbsp;통장잔액</div>
              <div class="sumVal red">
                <input id="ending" class="plainInput numInput" value="0" readonly />
              </div>
              <div class="sumFoot">* 숨김</div>
            </div>
          </div>
        </div>

        <!-- ✅ 12월 수입/지출 내역서 (텍스트 수정 가능) -->
        <div class="sectionTitle">
          <div class="dot"></div>
          <div contenteditable="true" id="ieTitle">12월 수입/지출 내역서</div>
        </div>

        <div class="noteLine" contenteditable="true">
          ( 수입은 한달전 생산된 금액입니다. 한달지연 입금됩니다 )
        </div>

        <!-- 수입/지출 표 -->
        <table class="tbl incomeExpense" id="ieTable">
          <colgroup>
            <col class="desc"><col class="amt">
            <col class="desc2"><col class="amt2">
            <col class="bigo">
          </colgroup>
          <thead>
            <tr>
              <th colspan="2" class="hIncome" contenteditable="true">수&nbsp;&nbsp;입</th>
              <th colspan="2" class="hExpense" contenteditable="true">지&nbsp;&nbsp;출</th>
              <th class="hBigo" contenteditable="true">비&nbsp;&nbsp;고</th>
            </tr>
            <tr>
              <th contenteditable="true">적&nbsp;&nbsp;요</th>
              <th contenteditable="true">금&nbsp;&nbsp;액</th>
              <th contenteditable="true">적&nbsp;&nbsp;요</th>
              <th contenteditable="true">금&nbsp;&nbsp;액</th>
              <th contenteditable="true"></th>
            </tr>
          </thead>
          <tbody id="ieBody">
            <!-- ✅ 12줄(캡처 느낌) -->
          </tbody>
          <tfoot>
            <tr class="sumRow">
              <td class="center bold" contenteditable="true">합&nbsp;&nbsp;계</td>
              <td class="right bold"><input id="incomeSum" class="plainInput numInput" value="0" readonly></td>
              <td class="center bold" contenteditable="true">합&nbsp;&nbsp;계</td>
              <td class="right bold"><input id="expenseSum" class="plainInput numInput" value="0" readonly></td>
              <td class="right bold"><input id="net2" class="plainInput numInput" value="0" readonly></td>
            </tr>
          </tfoot>
        </table>

        <!-- ✅ 12월 은행 입출금 내역 (텍스트 수정 가능) -->
        <div class="sectionTitle" style="margin-top:14px;">
          <div class="dot"></div>
          <div contenteditable="true" id="bankTitle">12월 은행 입출금 내역</div>
        </div>

        <div class="bankWrap">
          <div class="bankTables">

            <!-- 기업은행 -->
            <div>
              <div class="bankCardTitle" contenteditable="true">기&nbsp;업&nbsp;은&nbsp;행</div>

              <div class="bankTbl">
                <div class="prevRow">
                  <div class="label" contenteditable="true">전월이월액</div>
                  <div class="right">
                    <input id="ibkPrev" class="plainInput numInput" value="15,541,634" />
                  </div>
                </div>

                <table class="bankTbl" id="ibkTable">
                  <colgroup>
                    <col class="desc"><col class="in"><col class="out"><col class="bal">
                  </colgroup>
                  <thead>
                    <tr>
                      <th contenteditable="true">적요</th>
                      <th class="hIn" contenteditable="true">입금</th>
                      <th class="hOut" contenteditable="true">출금</th>
                      <th class="hBal" contenteditable="true">잔액</th>
                    </tr>
                  </thead>
                  <tbody id="ibkBody"></tbody>
                  <tfoot>
                    <tr class="sumRow">
                      <td class="center bold" contenteditable="true">합&nbsp;&nbsp;계</td>
                      <td class="right bold"><input id="ibkInSum" class="plainInput numInput" value="0" readonly></td>
                      <td class="right bold"><input id="ibkOutSum" class="plainInput numInput" value="0" readonly></td>
                      <td class="right bold"><input id="ibkEnd" class="plainInput numInput" value="0" readonly></td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>

            <!-- 농협 -->
            <div>
              <div class="bankCardTitle" contenteditable="true">농&nbsp;&nbsp;협</div>

              <div class="bankTbl">
                <div class="prevRow">
                  <div class="label" contenteditable="true">전월이월액</div>
                  <div class="right">
                    <input id="nhPrev" class="plainInput numInput" value="10,012,941" />
                  </div>
                </div>

                <table class="bankTbl" id="nhTable">
                  <colgroup>
                    <col class="desc"><col class="in"><col class="out"><col class="bal">
                  </colgroup>
                  <thead>
                    <tr>
                      <th contenteditable="true">적요</th>
                      <th class="hIn" contenteditable="true">입금</th>
                      <th class="hOut" contenteditable="true">출금</th>
                      <th class="hBal" contenteditable="true">잔액</th>
                    </tr>
                  </thead>
                  <tbody id="nhBody"></tbody>
                  <tfoot>
                    <tr class="sumRow">
                      <td class="center bold" contenteditable="true">합&nbsp;&nbsp;계</td>
                      <td class="right bold"><input id="nhInSum" class="plainInput numInput" value="0" readonly></td>
                      <td class="right bold"><input id="nhOutSum" class="plainInput numInput" value="0" readonly></td>
                      <td class="right bold"><input id="nhEnd" class="plainInput numInput" value="0" readonly></td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>

          </div>

          <!-- ✅ 통합잔액 1칸만 유지(문구도 수정 가능) -->
          <div class="integratedBox">
            <div class="integratedTitle" contenteditable="true">12월31일통합잔액</div>
            <div class="integratedVal">
              <span id="integratedVal">0</span>
            </div>
          </div>
        </div>

        <!-- ✅ 하단(테두리 전부 제거) -->
        <div class="bottomDate" contenteditable="true">2025년 12월 31일</div>

        <div class="bottomRow">
          <div class="bottomText" contenteditable="true">염전마을주민발전주식회사</div>
          <div class="bottomText" contenteditable="true">대표이사&nbsp;&nbsp;김&nbsp;진&nbsp;욱</div>
        </div>

      </div>
    </div>
  </div>

  <script>
    /* =========================
       유틸: 숫자 파싱/포맷
    ========================== */
    function toNumber(v){
      if(v==null) return 0;
      const s = String(v).replace(/[^\d\-]/g,'');
      if(s==='' || s==='-' ) return 0;
      return Number(s) || 0;
    }
    function comma(n){
      const neg = n < 0;
      const x = Math.abs(Math.round(n));
      const s = x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      return (neg ? "-" : "") + s;
    }
    function setVal(inputOrSpan, n){
      const s = comma(n);
      if(!inputOrSpan) return;
      if(inputOrSpan.tagName === 'INPUT') inputOrSpan.value = s;
      else inputOrSpan.textContent = s;
    }

    /* =========================
       iPhone 한 장 스케일
    ========================== */
    function applyScale(){
      const wrap = document.getElementById('sheetWrap');
      const sheetW = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--sheet-w')) || 900;
      const vw = Math.min(window.innerWidth, document.documentElement.clientWidth || window.innerWidth);
      const pad = 16; // 양옆 여백
      const scale = Math.min(1, (vw - pad) / sheetW);
      wrap.style.setProperty('--scale', scale.toFixed(4));
    }
    window.addEventListener('resize', applyScale);

    /* =========================
       표 생성 (캡처 느낌 줄수 고정)
    ========================== */

    // 수입/지출 12줄
    const ieDefaults = [
      {inDesc:"1차 SMP", inAmt:"8,508,100", outDesc:"송전료", outAmt:"347,720", bigo:""},
      {inDesc:"2차 SMP", inAmt:"6,967,300", outDesc:"이사회 식대", outAmt:"52,000", bigo:""},
      {inDesc:"3차 SMP", inAmt:"4,527,300", outDesc:"사랑과사랑세무사", outAmt:"154,000", bigo:""},
      {inDesc:"4차 SMP", inAmt:"1,895,650", outDesc:"보상금", outAmt:"10,500,500", bigo:""},
      {inDesc:"KT 전력예측", inAmt:"0", outDesc:"대표및이사회수당", outAmt:"800,000", bigo:""},
      {inDesc:"rec", inAmt:"0", outDesc:"군청근조화환", outAmt:"100,000", bigo:""},
      {inDesc:"이자", inAmt:"946", outDesc:"이음복스", outAmt:"93,700", bigo:""},
      {inDesc:"이자", inAmt:"5,492", outDesc:"토지임대료", outAmt:"14,300,000", bigo:""},
      {inDesc:"", inAmt:"0", outDesc:"운영비", outAmt:"11,000,500", bigo:""},
      {inDesc:"", inAmt:"0", outDesc:"", outAmt:"0", bigo:""},
      {inDesc:"", inAmt:"0", outDesc:"", outAmt:"0", bigo:""},
      {inDesc:"", inAmt:"0", outDesc:"", outAmt:"0", bigo:""},
    ];

    function buildIncomeExpense(){
      const tbody = document.getElementById('ieBody');
      tbody.innerHTML = "";
      ieDefaults.forEach((r, idx)=>{
        const tr = document.createElement('tr');

        // 수입 적요(색 약간)
        const td1 = document.createElement('td');
        td1.style.background = "#f7f7f7";
        td1.contentEditable = "true";
        td1.textContent = r.inDesc || "";
        tr.appendChild(td1);

        // 수입 금액(색 약간)
        const td2 = document.createElement('td');
        td2.className = "right";
        td2.style.background = "#fbfbfb";
        td2.innerHTML = `<input class="plainInput numInput ieIn" value="${r.inAmt || "0"}" />`;
        tr.appendChild(td2);

        // 지출 적요(색 약간)
        const td3 = document.createElement('td');
        td3.style.background = "#f7f7f7";
        td3.contentEditable = "true";
        td3.textContent = r.outDesc || "";
        tr.appendChild(td3);

        // 지출 금액(색 약간)
        const td4 = document.createElement('td');
        td4.className = "right";
        td4.style.background = "#fbfbfb";
        td4.innerHTML = `<input class="plainInput numInput ieOut" value="${r.outAmt || "0"}" />`;
        tr.appendChild(td4);

        // 비고
        const td5 = document.createElement('td');
        td5.contentEditable = "true";
        td5.textContent = r.bigo || "";
        tr.appendChild(td5);

        tbody.appendChild(tr);
      });
    }

    // 은행 14줄(캡처 느낌)
    const bankRows = 14;

    const ibkDefaults = [
      {desc:"전력거래소", inAmt:"8,508,100", outAmt:"0"},
      {desc:"염전마을주", inAmt:"0", outAmt:"15,500,000"},
      {desc:"이자", inAmt:"946", outAmt:"0"},
      {desc:"전력거래소", inAmt:"6,967,300", outAmt:"0"},
      {desc:"전력거래소", inAmt:"4,527,300", outAmt:"0"},
      {desc:"염전마을주", inAmt:"0", outAmt:"14,300,000"},
      {desc:"전력거래소", inAmt:"1,895,650", outAmt:"0"},
      {desc:"", inAmt:"0", outAmt:"0"},
      {desc:"", inAmt:"0", outAmt:"0"},
      {desc:"", inAmt:"0", outAmt:"0"},
      {desc:"", inAmt:"0", outAmt:"0"},
      {desc:"", inAmt:"0", outAmt:"0"},
      {desc:"", inAmt:"0", outAmt:"0"},
      {desc:"", inAmt:"0", outAmt:"0"},
    ];

    const nhDefaults = [
      {desc:"이음복스", inAmt:"0", outAmt:"93,700"},
      {desc:"이사회식대", inAmt:"0", outAmt:"52,000"},
      {desc:"염전마을주", inAmt:"15,500,000", outAmt:"0"},
      {desc:"송전료", inAmt:"0", outAmt:"347,720"},
      {desc:"김균태회계", inAmt:"0", outAmt:"154,000"},
      {desc:"보상금", inAmt:"0", outAmt:"10,500,500"},
      {desc:"대표,이사회수당", inAmt:"0", outAmt:"800,000"},
      {desc:"군청근조화환", inAmt:"0", outAmt:"100,000"},
      {desc:"운영비", inAmt:"0", outAmt:"11,000,500"},
      {desc:"이자", inAmt:"5,492", outAmt:"0"},
      {desc:"", inAmt:"0", outAmt:"0"},
      {desc:"", inAmt:"0", outAmt:"0"},
      {desc:"", inAmt:"0", outAmt:"0"},
      {desc:"", inAmt:"0", outAmt:"0"},
    ];

    function buildBankTable(tbodyId, defaults){
      const tbody = document.getElementById(tbodyId);
      tbody.innerHTML = "";
      for(let i=0;i<bankRows;i++){
        const r = defaults[i] || {desc:"", inAmt:"0", outAmt:"0"};
        const tr = document.createElement('tr');

        const td1 = document.createElement('td');
        td1.contentEditable = "true";
        td1.textContent = r.desc || "";
        tr.appendChild(td1);

        const td2 = document.createElement('td');
        td2.className = "right num";
        td2.innerHTML = `<input class="plainInput numInput bankIn" value="${r.inAmt || "0"}" />`;
        tr.appendChild(td2);

        const td3 = document.createElement('td');
        td3.className = "right num";
        td3.innerHTML = `<input class="plainInput numInput bankOut" value="${r.outAmt || "0"}" />`;
        tr.appendChild(td3);

        const td4 = document.createElement('td');
        td4.className = "right num";
        td4.innerHTML = `<input class="plainInput numInput bankBal" value="0" readonly />`;
        tr.appendChild(td4);

        tbody.appendChild(tr);
      }
    }

    /* =========================
       자동 계산 로직
       - 수입/지출 합계
       - 수입-지출
       - 이월금액 + (수입-지출) = 12/31 잔액
       - 은행 잔액 누적(전월이월액부터)
       - 통합잔액 = 기업은행 최종 + 농협 최종
    ========================== */
    function calcIncomeExpense(){
      const inInputs = document.querySelectorAll('#ieTable .ieIn');
      const outInputs = document.querySelectorAll('#ieTable .ieOut');

      let inSum=0, outSum=0;
      inInputs.forEach(el=> inSum += toNumber(el.value));
      outInputs.forEach(el=> outSum += toNumber(el.value));

      const net = inSum - outSum;

      setVal(document.getElementById('incomeSum'), inSum);
      setVal(document.getElementById('expenseSum'), outSum);
      setVal(document.getElementById('net2'), net);
      setVal(document.getElementById('net'), net);

      const carry = toNumber(document.getElementById('carry').value);
      const ending = carry + net;
      setVal(document.getElementById('ending'), ending);
    }

    function calcBankOne(tableId, prevId, inSumId, outSumId, endId){
      const prev = toNumber(document.getElementById(prevId).value);
      const rows = document.querySelectorAll(`#${tableId} tbody tr`);

      let bal = prev;
      let inSum = 0;
      let outSum = 0;

      rows.forEach(tr=>{
        const inEl = tr.querySelector('.bankIn');
        const outEl = tr.querySelector('.bankOut');
        const balEl = tr.querySelector('.bankBal');

        const din = toNumber(inEl.value);
        const dout = toNumber(outEl.value);

        inSum += din;
        outSum += dout;

        bal = bal + din - dout;
        setVal(balEl, bal);
      });

      setVal(document.getElementById(inSumId), inSum);
      setVal(document.getElementById(outSumId), outSum);
      setVal(document.getElementById(endId), bal);

      return bal;
    }

    function calcAll(){
      // 숫자 입력값을 즉시 콤마 정리(커서 방해 줄이기 위해 blur 때도 처리)
      // 여기서는 계산만, 포맷은 blur 이벤트에서
      calcIncomeExpense();

      const ibkEnd = calcBankOne('ibkTable','ibkPrev','ibkInSum','ibkOutSum','ibkEnd');
      const nhEnd  = calcBankOne('nhTable','nhPrev','nhInSum','nhOutSum','nhEnd');

      setVal(document.getElementById('integratedVal'), ibkEnd + nhEnd);
    }

    function attachEvents(){
      // 입력 변화마다 계산
      document.addEventListener('input', (e)=>{
        if(e.target.matches('.ieIn,.ieOut,.bankIn,.bankOut,#carry,#ibkPrev,#nhPrev')) calcAll();
      });

      // blur 시 콤마 포맷 적용
      document.addEventListener('blur', (e)=>{
        const t = e.target;
        if(t && t.tagName==='INPUT' && t.classList.contains('numInput') && !t.readOnly){
          const n = toNumber(t.value);
          t.value = comma(n);
        }
      }, true);
    }

    /* =========================
       초기화
    ========================== */
    buildIncomeExpense();
    buildBankTable('ibkBody', ibkDefaults);
    buildBankTable('nhBody', nhDefaults);

    attachEvents();
    applyScale();

    // 최초 계산 + 최초 포맷
    // (사용자가 이미 콤마 있는 값도 그대로 유지)
    calcAll();
  </script>
</body>
</html>
